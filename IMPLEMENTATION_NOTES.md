# GitHubログイン機能とデータ同期の実装について

## 概要

このPRでは、GitHubアカウントでのログイン機能と、デバイス間でのデータ自動同期機能を実装しました。

## 主な変更点

### 1. バックエンドの追加

新しく `backend/` ディレクトリを追加し、以下の機能を持つNode.jsサーバーを実装しました：

- **GitHub OAuth 2.0認証**: Passport.jsを使用
- **SQLiteデータベース**: ユーザーデータの永続化
- **RESTful API**: データの取得・保存エンドポイント
- **セッション管理**: Cookie-based認証

### 2. フロントエンドの変更

- **認証サービス** (`src/runtime/ts/auth.ts`): GitHubログイン/ログアウトの管理
- **ストレージ抽象化** (`src/runtime/ts/storage.ts`): ローカル/リモートストレージの統一インターフェース
- **履歴同期機能**: 既存の履歴管理にリモート同期機能を追加
- **UIの更新**: ツールバーにログインボタンとユーザー情報を表示

### 3. データ同期の仕組み

#### ログイン時
1. ローカルとリモートのデータを取得
2. タイムスタンプを比較して新しいデータを選択
3. 両方をマージして保存

#### 通常時
- データ変更時に500msデバウンスしてリモートに自動保存
- ローカルストレージにも並行して保存（オフライン対応）

#### ログアウト時
- セッションを破棄
- ローカルデータは保持（次回ログイン時に同期）

## 使用技術

### バックエンド
- **Express.js**: Webフレームワーク
- **Passport.js**: OAuth認証
- **better-sqlite3**: 軽量データベース
- **express-session**: セッション管理
- **cors**: クロスオリジン対応

### フロントエンド
- **TypeScript**: 既存コードベースと統合
- **Fetch API**: バックエンドとの通信
- **React Hooks**: 認証状態の管理

## セキュリティ

- HTTPS推奨（本番環境）
- HTTPOnly Cookie（XSS対策）
- SameSite=Lax（CSRF対策）
- セッションシークレットの環境変数化
- GitHubのOAuth Scopeは最小限（user:email）

## パフォーマンス

- **デバウンス**: 500msの遅延で不要なAPI呼び出しを削減
- **ローカルキャッシュ**: ローカルストレージで高速読み込み
- **LZ-String圧縮**: データ転送量を削減（既存機能を維持）
- **SQLite**: 軽量で高速なデータベース

## 下位互換性

- ログインしなくても従来通り動作
- 既存のローカルデータは保持
- URLハッシュ共有機能は引き続き動作

## デプロイ

### 開発環境
1. GitHub OAuth Appの作成
2. `.env`ファイルの設定
3. バックエンドとフロントエンドを起動

### 本番環境
1. バックエンドを専用サーバーにデプロイ
2. 環境変数を設定
3. フロントエンドをビルド＆デプロイ
4. GitHub OAuth Appの設定を更新

詳細は `SETUP_AUTH.md` を参照してください。

## 今後の拡張案

- [ ] 他のOAuthプロバイダー（Google、Twitter）のサポート
- [ ] リアルタイム同期（WebSocket）
- [ ] 共同編集機能
- [ ] バージョン履歴（Git風）
- [ ] データのエクスポート/インポート
- [ ] プロフィール設定画面

## トラブルシューティング

よくある問題と解決策は `SETUP_AUTH.md` の「トラブルシューティング」セクションを参照してください。

## ライセンス

既存のプロジェクトライセンスに準拠します（MIT）。
